# 供应链管理系统 - 数据库设计说明书

## 文档信息

| 项目名称 | 供应链管理系统 |
|---------|--------------|
| 文档版本 | V1.0 |
| 编写日期 | 2026-02-13 |
| 文档状态 | 正式发布 |

---

## 1. 数据库概述

### 1.1 数据库类型

- 数据库类型：MySQL 8.0+
- 字符集：utf8mb4
- 排序规则：utf8mb4_unicode_ci

### 1.2 数据库命名规范

- 数据库名：scm_db
- 表名：使用小写字母和下划线，采用复数形式
- 字段名：使用小写字母和下划线
- 索引名：idx_表名_字段名
- 主键：id
- 外键：表名_id

---

## 2. 数据表设计

### 2.1 用户相关表

#### 2.1.1 users - 用户表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| username | VARCHAR | 50 | 是 | - | 用户名，唯一 |
| password | VARCHAR | 255 | 是 | - | 密码，加密存储 |
| real_name | VARCHAR | 50 | 否 | - | 真实姓名 |
| email | VARCHAR | 100 | 否 | - | 邮箱 |
| phone | VARCHAR | 20 | 否 | - | 手机号 |
| avatar | VARCHAR | 255 | 否 | - | 头像URL |
| status | BOOLEAN | - | 否 | TRUE | 状态 |
| department_id | INT | - | 否 | - | 部门ID |
| is_superuser | BOOLEAN | - | 否 | FALSE | 是否超级管理员 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_username (username)
- PRIMARY KEY (id)

**外键：**
- department_id → departments.id

#### 2.1.2 departments - 部门表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| name | VARCHAR | 100 | 是 | - | 部门名称 |
| code | VARCHAR | 50 | 是 | - | 部门编码，唯一 |
| parent_id | INT | - | 否 | - | 父部门ID |
| sort_order | INT | - | 否 | 0 | 排序 |
| leader | VARCHAR | 50 | 否 | - | 负责人 |
| phone | VARCHAR | 20 | 否 | - | 联系电话 |
| address | VARCHAR | 255 | 否 | - | 地址 |
| description | TEXT | - | 否 | - | 部门描述 |
| status | INT | - | 否 | 1 | 状态 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- PRIMARY KEY (id)

**外键：**
- parent_id → departments.id

#### 2.1.3 roles - 角色表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| name | VARCHAR | 50 | 是 | - | 角色名称，唯一 |
| code | VARCHAR | 50 | 是 | - | 角色编码，唯一 |
| description | TEXT | - | 否 | - | 角色描述 |
| status | BOOLEAN | - | 否 | TRUE | 状态 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_name (name)
- idx_code (code)
- PRIMARY KEY (id)

#### 2.1.4 permissions - 权限表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| name | VARCHAR | 50 | 是 | - | 权限名称，唯一 |
| code | VARCHAR | 100 | 是 | - | 权限编码，唯一 |
| type | VARCHAR | 20 | 是 | - | 权限类型 |
| description | TEXT | - | 否 | - | 权限描述 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_name (name)
- idx_code (code)
- PRIMARY KEY (id)

#### 2.1.5 user_roles - 用户角色关联表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| user_id | INT | - | 是 | - | 用户ID |
| role_id | INT | - | 是 | - | 角色ID |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**外键：**
- user_id → users.id (ON DELETE CASCADE)
- role_id → roles.id (ON DELETE CASCADE)

#### 2.1.6 role_permissions - 角色权限关联表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| role_id | INT | - | 是 | - | 角色ID |
| permission_id | INT | - | 是 | - | 权限ID |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**外键：**
- role_id → roles.id (ON DELETE CASCADE)
- permission_id → permissions.id (ON DELETE CASCADE)

#### 2.1.7 menus - 菜单表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| name | VARCHAR | 50 | 是 | - | 菜单名称 |
| code | VARCHAR | 50 | 是 | - | 菜单编码 |
| path | VARCHAR | 255 | 否 | - | 路由路径 |
| component | VARCHAR | 255 | 否 | - | 组件路径 |
| icon | VARCHAR | 50 | 否 | - | 图标 |
| parent_id | INT | - | 否 | - | 父菜单ID |
| sort_order | INT | - | 否 | 0 | 排序 |
| status | INT | - | 否 | 1 | 状态 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**外键：**
- parent_id → menus.id

---

### 2.2 供应商管理表

#### 2.2.1 suppliers - 供应商表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| name | VARCHAR | 200 | 是 | - | 供应商名称 |
| code | VARCHAR | 50 | 是 | - | 供应商编码，唯一 |
| contact | VARCHAR | 50 | 否 | - | 联系人 |
| phone | VARCHAR | 20 | 否 | - | 联系电话 |
| address | VARCHAR | 255 | 否 | - | 地址 |
| email | VARCHAR | 100 | 否 | - | 邮箱 |
| tax_number | VARCHAR | 50 | 否 | - | 税号 |
| bank_name | VARCHAR | 100 | 否 | - | 开户银行 |
| bank_account | VARCHAR | 50 | 否 | - | 银行账号 |
| status | INT | - | 否 | 1 | 状态 |
| remark | TEXT | - | 否 | - | 备注 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- idx_name (name)
- PRIMARY KEY (id)

---

### 2.3 采购管理表

#### 2.3.1 purchase_orders - 采购订单表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| code | VARCHAR | 50 | 是 | - | 采购单号，唯一 |
| supplier_id | INT | - | 是 | - | 供应商ID |
| purchase_date | DATETIME | - | 否 | - | 采购日期 |
| expected_date | DATETIME | - | 否 | - | 预计到货日期 |
| total_amount | DECIMAL | 15,2 | 否 | 0.00 | 总金额 |
| paid_amount | DECIMAL | 15,2 | 否 | 0.00 | 已付金额 |
| status | VARCHAR | 20 | 否 | pending | 状态 |
| approval_status | VARCHAR | 20 | 否 | pending | 审批状态 |
| approved_by | INT | - | 否 | - | 审批人 |
| approved_at | DATETIME | - | 否 | - | 审批时间 |
| remark | TEXT | - | 否 | - | 备注 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- idx_supplier (supplier_id)
- idx_status (status)
- PRIMARY KEY (id)

**外键：**
- supplier_id → suppliers.id
- approved_by → users.id

#### 2.3.2 purchase_order_items - 采购订单明细表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| purchase_order_id | INT | - | 是 | - | 采购单ID |
| product_code | VARCHAR | 50 | 否 | - | 产品编码 |
| product_name | VARCHAR | 200 | 是 | - | 产品名称 |
| specification | VARCHAR | 100 | 否 | - | 规格型号 |
| unit | VARCHAR | 20 | 否 | - | 单位 |
| quantity | DECIMAL | 10,2 | 是 | - | 数量 |
| unit_price | DECIMAL | 10,2 | 是 | - | 单价 |
| amount | DECIMAL | 15,2 | 是 | - | 金额 |
| received_quantity | DECIMAL | 10,2 | 否 | 0.00 | 已收货数量 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**外键：**
- purchase_order_id → purchase_orders.id (ON DELETE CASCADE)

---

### 2.4 库存管理表

#### 2.4.1 product_categories - 产品分类表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| name | VARCHAR | 100 | 是 | - | 分类名称 |
| code | VARCHAR | 50 | 是 | - | 分类编码，唯一 |
| parent_id | INT | - | 否 | - | 父分类ID |
| sort_order | INT | - | 否 | 0 | 排序 |
| description | TEXT | - | 否 | - | 描述 |
| status | INT | - | 否 | 1 | 状态 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- PRIMARY KEY (id)

**外键：**
- parent_id → product_categories.id

#### 2.4.2 products - 产品表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| code | VARCHAR | 50 | 是 | - | 产品编码，唯一 |
| name | VARCHAR | 200 | 是 | - | 产品名称 |
| category_id | INT | - | 否 | - | 分类ID |
| specification | VARCHAR | 100 | 否 | - | 规格型号 |
| unit | VARCHAR | 20 | 否 | - | 单位 |
| purchase_price | DECIMAL | 10,2 | 否 | 0.00 | 采购价 |
| sale_price | DECIMAL | 10,2 | 否 | 0.00 | 销售价 |
| min_stock | DECIMAL | 10,2 | 否 | 0.00 | 最小库存 |
| max_stock | DECIMAL | 10,2 | 否 | 0.00 | 最大库存 |
| current_stock | DECIMAL | 10,2 | 否 | 0.00 | 当前库存 |
| status | VARCHAR | 20 | 否 | active | 状态 |
| remark | TEXT | - | 否 | - | 备注 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- idx_name (name)
- PRIMARY KEY (id)

**外键：**
- category_id → product_categories.id

#### 2.4.3 warehouses - 仓库表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| code | VARCHAR | 50 | 是 | - | 仓库编码，唯一 |
| name | VARCHAR | 100 | 是 | - | 仓库名称 |
| type | VARCHAR | 20 | 否 | normal | 仓库类型 |
| address | VARCHAR | 255 | 否 | - | 地址 |
| manager | VARCHAR | 50 | 否 | - | 负责人 |
| phone | VARCHAR | 20 | 否 | - | 联系电话 |
| capacity | DECIMAL | 10,2 | 否 | 0.00 | 容量 |
| status | INT | - | 否 | 1 | 状态 |
| remark | TEXT | - | 否 | - | 备注 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- PRIMARY KEY (id)

#### 2.4.4 stock_records - 出入库记录表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| code | VARCHAR | 50 | 是 | - | 出入库单号，唯一 |
| type | VARCHAR | 20 | 是 | - | 类型 |
| warehouse_id | INT | - | 是 | - | 仓库ID |
| product_id | INT | - | 是 | - | 产品ID |
| quantity | DECIMAL | 10,2 | 是 | - | 数量 |
| unit_price | DECIMAL | 10,2 | 否 | 0.00 | 单价 |
| amount | DECIMAL | 15,2 | 否 | 0.00 | 金额 |
| reference_code | VARCHAR | 50 | 否 | - | 关联单号 |
| reference_type | VARCHAR | 20 | 否 | - | 关联类型 |
| operator_id | INT | - | 否 | - | 操作人 |
| remark | TEXT | - | 否 | - | 备注 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- idx_warehouse (warehouse_id)
- idx_product (product_id)
- PRIMARY KEY (id)

**外键：**
- warehouse_id → warehouses.id
- product_id → products.id
- operator_id → users.id

#### 2.4.5 stock_checks - 库存盘点表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| code | VARCHAR | 50 | 是 | - | 盘点单号，唯一 |
| warehouse_id | INT | - | 是 | - | 仓库ID |
| check_date | DATETIME | - | 否 | - | 盘点日期 |
| status | VARCHAR | 20 | 否 | pending | 状态 |
| operator_id | INT | - | 否 | - | 盘点人 |
| remark | TEXT | - | 否 | - | 备注 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- idx_warehouse (warehouse_id)
- PRIMARY KEY (id)

**外键：**
- warehouse_id → warehouses.id
- operator_id → users.id

#### 2.4.6 stock_check_items - 盘点明细表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| stock_check_id | INT | - | 是 | - | 盘点单ID |
| product_id | INT | - | 是 | - | 产品ID |
| book_quantity | DECIMAL | 10,2 | 否 | - | 账面数量 |
| actual_quantity | DECIMAL | 10,2 | 否 | - | 实际数量 |
| diff_quantity | DECIMAL | 10,2 | 否 | - | 差异数量 |
| remark | TEXT | - | 否 | - | 备注 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**外键：**
- stock_check_id → stock_checks.id (ON DELETE CASCADE)
- product_id → products.id

---

### 2.5 销售管理表

#### 2.5.1 customers - 客户表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| name | VARCHAR | 200 | 是 | - | 客户名称 |
| code | VARCHAR | 50 | 是 | - | 客户编码，唯一 |
| contact | VARCHAR | 50 | 否 | - | 联系人 |
| phone | VARCHAR | 20 | 否 | - | 联系电话 |
| address | VARCHAR | 255 | 否 | - | 地址 |
| email | VARCHAR | 100 | 否 | - | 邮箱 |
| status | INT | - | 否 | 1 | 状态 |
| remark | TEXT | - | 否 | - | 备注 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- idx_name (name)
- PRIMARY KEY (id)

#### 2.5.2 sales_orders - 销售订单表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| code | VARCHAR | 50 | 是 | - | 销售单号，唯一 |
| customer_id | INT | - | 是 | - | 客户ID |
| sale_date | DATETIME | - | 否 | - | 销售日期 |
| total_amount | DECIMAL | 15,2 | 否 | 0.00 | 总金额 |
| paid_amount | DECIMAL | 15,2 | 否 | 0.00 | 已收金额 |
| status | VARCHAR | 20 | 否 | pending | 状态 |
| approval_status | VARCHAR | 20 | 否 | pending | 审批状态 |
| approved_by | INT | - | 否 | - | 审批人 |
| approved_at | DATETIME | - | 否 | - | 审批时间 |
| remark | TEXT | - | 否 | - | 备注 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- idx_customer (customer_id)
- idx_status (status)
- PRIMARY KEY (id)

**外键：**
- customer_id → customers.id
- approved_by → users.id

#### 2.5.3 sales_order_items - 销售订单明细表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| sales_order_id | INT | - | 是 | - | 销售单ID |
| product_code | VARCHAR | 50 | 否 | - | 产品编码 |
| product_name | VARCHAR | 200 | 是 | - | 产品名称 |
| specification | VARCHAR | 100 | 否 | - | 规格型号 |
| unit | VARCHAR | 20 | 否 | - | 单位 |
| quantity | DECIMAL | 10,2 | 是 | - | 数量 |
| unit_price | DECIMAL | 10,2 | 是 | - | 单价 |
| amount | DECIMAL | 15,2 | 是 | - | 金额 |
| shipped_quantity | DECIMAL | 10,2 | 否 | 0.00 | 已发货数量 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**外键：**
- sales_order_id → sales_orders.id (ON DELETE CASCADE)

---

### 2.6 财务管理表

#### 2.6.1 payments - 收付款表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| code | VARCHAR | 50 | 是 | - | 收付款单号，唯一 |
| type | VARCHAR | 20 | 是 | - | 类型 |
| amount | DECIMAL | 15,2 | 是 | - | 金额 |
| payment_method | VARCHAR | 20 | 否 | - | 付款方式 |
| payment_date | DATETIME | - | 否 | - | 收付款日期 |
| reference_code | VARCHAR | 50 | 否 | - | 关联单号 |
| reference_type | VARCHAR | 20 | 否 | - | 关联类型 |
| supplier_id | INT | - | 否 | - | 供应商ID |
| customer_id | INT | - | 否 | - | 客户ID |
| bank_account | VARCHAR | 50 | 否 | - | 银行账号 |
| status | VARCHAR | 20 | 否 | pending | 状态 |
| approval_status | VARCHAR | 20 | 否 | pending | 审批状态 |
| approved_by | INT | - | 否 | - | 审批人 |
| approved_at | DATETIME | - | 否 | - | 审批时间 |
| operator_id | INT | - | 否 | - | 操作人 |
| remark | TEXT | - | 否 | - | 备注 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- idx_type (type)
- PRIMARY KEY (id)

**外键：**
- supplier_id → suppliers.id
- customer_id → customers.id
- approved_by → users.id
- operator_id → users.id

#### 2.6.2 bills - 账单表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| code | VARCHAR | 50 | 是 | - | 单据号，唯一 |
| type | VARCHAR | 20 | 是 | - | 类型 |
| amount | DECIMAL | 15,2 | 是 | - | 金额 |
| bill_date | DATETIME | - | 否 | - | 单据日期 |
| due_date | DATETIME | - | 否 | - | 到期日期 |
| reference_code | VARCHAR | 50 | 否 | - | 关联单号 |
| reference_type | VARCHAR | 20 | 否 | - | 关联类型 |
| supplier_id | INT | - | 否 | - | 供应商ID |
| customer_id | INT | - | 否 | - | 客户ID |
| paid_amount | DECIMAL | 15,2 | 否 | 0.00 | 已付金额 |
| remaining_amount | DECIMAL | 15,2 | 否 | - | 剩余金额 |
| status | VARCHAR | 20 | 否 | unpaid | 状态 |
| remark | TEXT | - | 否 | - | 备注 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- idx_type (type)
- PRIMARY KEY (id)

**外键：**
- supplier_id → suppliers.id
- customer_id → customers.id

#### 2.6.3 accounts - 账户表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| name | VARCHAR | 100 | 是 | - | 账户名称 |
| code | VARCHAR | 50 | 是 | - | 账户编码，唯一 |
| type | VARCHAR | 20 | 否 | - | 账户类型 |
| bank_name | VARCHAR | 100 | 否 | - | 开户银行 |
| account_number | VARCHAR | 50 | 否 | - | 账号 |
| balance | DECIMAL | 15,2 | 否 | 0.00 | 余额 |
| status | INT | - | 否 | 1 | 状态 |
| remark | TEXT | - | 否 | - | 备注 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- PRIMARY KEY (id)

#### 2.6.4 cost_centers - 成本中心表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| name | VARCHAR | 100 | 是 | - | 成本中心名称 |
| code | VARCHAR | 50 | 是 | - | 编码，唯一 |
| parent_id | INT | - | 否 | - | 父级ID |
| description | TEXT | - | 否 | - | 描述 |
| status | INT | - | 否 | 1 | 状态 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- PRIMARY KEY (id)

**外键：**
- parent_id → cost_centers.id

---

### 2.7 工作流管理表

#### 2.7.1 workflow_definitions - 工作流定义表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| name | VARCHAR | 100 | 是 | - | 工作流名称 |
| code | VARCHAR | 50 | 是 | - | 工作流编码，唯一 |
| type | VARCHAR | 50 | 是 | - | 工作流类型 |
| description | TEXT | - | 否 | - | 描述 |
| config | JSON | - | 否 | - | 配置信息 |
| status | INT | - | 否 | 1 | 状态 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_code (code)
- PRIMARY KEY (id)

#### 2.7.2 workflow_instances - 工作流实例表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| definition_id | INT | - | 是 | - | 定义ID |
| business_type | VARCHAR | 50 | 是 | - | 业务类型 |
| business_id | INT | - | 是 | - | 业务ID |
| status | VARCHAR | 20 | 否 | pending | 状态 |
| current_step | VARCHAR | 50 | 否 | - | 当前步骤 |
| initiator_id | INT | - | 否 | - | 发起人 |
| started_at | DATETIME | - | 否 | - | 开始时间 |
| completed_at | DATETIME | - | 否 | - | 完成时间 |
| remark | TEXT | - | 否 | - | 备注 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**索引：**
- idx_business (business_type, business_id)
- PRIMARY KEY (id)

**外键：**
- definition_id → workflow_definitions.id
- initiator_id → users.id

#### 2.7.3 workflow_logs - 工作流日志表

| 字段名 | 类型 | 长度 | 是否必填 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | INT | - | 是 | - | 主键，自增 |
| instance_id | INT | - | 是 | - | 实例ID |
| action | VARCHAR | 50 | 是 | - | 动作 |
| step | VARCHAR | 50 | 否 | - | 步骤 |
| operator_id | INT | - | 否 | - | 操作人 |
| comment | TEXT | - | 否 | - | 备注 |
| created_at | DATETIME | - | 是 | - | 创建时间 |
| updated_at | DATETIME | - | 是 | - | 更新时间 |

**外键：**
- instance_id → workflow_instances.id (ON DELETE CASCADE)
- operator_id → users.id

---

## 3. 数据库初始化脚本

### 3.1 创建数据库

```sql
CREATE DATABASE IF NOT EXISTS scm_db 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

USE scm_db;
```

### 3.2 创建表结构

详细建表SQL脚本见 `backend/init_db.py` 或使用SQLAlchemy ORM自动创建表结构。

### 3.3 初始化数据

```sql
-- 插入默认管理员用户
INSERT INTO users (username, password, real_name, is_superuser, status, created_at, updated_at)
VALUES ('admin', '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5NUqVV0Q6H.2O', '系统管理员', TRUE, TRUE, NOW(), NOW());

-- 插入默认角色
INSERT INTO roles (name, code, status, created_at, updated_at)
VALUES ('超级管理员', 'admin', TRUE, NOW(), NOW());

INSERT INTO roles (name, code, status, created_at, updated_at)
VALUES ('采购员', 'purchaser', TRUE, NOW(), NOW());

INSERT INTO roles (name, code, status, created_at, updated_at)
VALUES ('销售员', 'salesman', TRUE, NOW(), NOW());

-- 为管理员分配角色
INSERT INTO user_roles (user_id, role_id, created_at, updated_at)
VALUES (1, 1, NOW(), NOW());
```

---

## 4. 数据库维护

### 4.1 备份策略

- 每日全量备份
- 保留最近30天的备份
- 备份文件命名：scm_db_YYYYMMDD.sql

### 4.2 性能优化

- 为常用查询字段创建索引
- 定期分析慢查询日志
- 定期优化表结构

### 4.3 安全策略

- 数据库访问权限严格控制
- 定期更新数据库密码
- 启用数据库审计日志

---

## 5. 附录

### 5.1 数据库连接配置

```python
# app/core/config.py
DATABASE_URL = "mysql+pymysql://username:password@localhost:3306/scm_db"
```

### 5.2 数据库迁移

项目使用SQLAlchemy ORM，表结构由代码自动创建。如需手动管理数据库迁移，可使用Alembic工具。

### 5.3 术语表

| 术语 | 说明 |
|------|------|
| ORM | 对象关系映射 |
| PRIMARY KEY | 主键 |
| FOREIGN KEY | 外键 |
| INDEX | 索引 |
| UNIQUE | 唯一约束 |
| CASCADE | 级联操作 |
